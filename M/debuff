local index = 0
local auraID = 194384
local debuffs = {
    "虚空裂隙", --萨拉塔丝
    "暗影烈焰笼罩", "暮光烈焰", "熵能诅咒", "深渊腐蚀", --巴托
    "虚空感染", "结晶喷发", "不稳定的爆炸", "虚空腐蚀", --宝库
    "过度生长", "排斥", "不稳定的酸液", "钉刺突袭", --仙林
    "虚空奔袭", "贪婪之虫", "腐化附层", "捻接", --千丝
    "暗影之幕", "折磨光束", "迸发虫茧", "诱捕暗影", --破晨
    "艾泽里特炸药", "腐败之水", --围攻
}

local function hasDebuff(unit)
    for _, debuff in ipairs(debuffs) do
        for i = 1, 40 do
            local DebuffData = C_UnitAuras.GetAuraDataByIndex(unit, i, "HARMFUL")
            if not DebuffData then break end
            if DebuffData.name == debuff then
                return true
            end
        end
    end
    return false
end

local function hasAura(unit)
    for i = 1, 40 do
        local BuffData = C_UnitAuras.GetAuraDataByIndex(unit, i, "HELPFUL")
        if not BuffData then break end
        if BuffData.spellId == auraID then
            return true
        end
    end
    return false
end

if UnitExists("player") and not UnitIsDeadOrGhost("player") and hasDebuff("player") and not hasAura("player") then
    index = 1
    return index
end

for i = 1, 4 do
    local unit = "party" .. i
    if UnitExists(unit) and not UnitIsDeadOrGhost(unit) then
        if hasDebuff(unit) and not hasAura(unit) then
            index = i + 1
            return index
        end
    end
end

return index