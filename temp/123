local lowest = 0
local lowestHealth = 100
local playerHealth = UnitHealth("player") / UnitHealthMax("player") * 100

local function getCooldown(spellID)
    local cooldown = C_Spell.GetSpellCooldown(spellID)
    return (cooldown.startTime > 0) and (cooldown.startTime + cooldown.duration - GetTime()) or 0
end

local LayonHands = getCooldown(633)

if UnitPlayerOrPetInParty("player") then
    for i = 1, 4 do
        local unit = "party" .. i
        if UnitExists(unit) and not UnitIsDeadOrGhost(unit) and UnitCanAssist("player", unit) and UnitInRange(unit) then
            local UnitHealth = UnitHealth(unit) / UnitHealthMax(unit) * 100
            if UnitHealth < lowestHealth then
                lowestHealth = UnitHealth
                lowest = i + 1
            end
            if playerHealth < lowestHealth then
                lowestHealth = playerHealth
                lowest = 1
            end
        end
    end
end

if lowestHealth < 40 and LayonHands == 0 then
    return lowest
else
    return 0
end
